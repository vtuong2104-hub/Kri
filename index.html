<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Squirrel's Paw - Base64 Expert</title>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }
    .app-container {
        width: 100%;
        max-width: 400px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; color: #333; margin-bottom: 5px; }
    
    textarea, select, .btn {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 14px;
        outline: none;
    }

    #fBtn { background: #6c5ce7; color: white; display: none; font-weight: bold; border: none; cursor: pointer; }
    
    /* Tr·∫°ng th√°i x·ª≠ l√Ω file */
    #status {
        font-size: 13px;
        text-align: center;
        font-weight: bold;
        display: none;
        padding: 5px;
        border-radius: 5px;
    }
    .status-success { color: #00b894; background: #e6faf5; }
    .status-wait { color: #e17055; background: #fff3f0; }

    /* KHUNG QR */
    #qrSection {
        border: 2px dashed #ddd;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        background: #fafafa;
        margin-top: 10px;
    }
    #qrImg { width: 180px; height: 180px; margin-bottom: 15px; background: white; }

    .btn { cursor: pointer; border: none; font-weight: bold; color: white; margin-top: 8px; }
    .btn-qr { background: #0984e3; }
    .btn-txt { background: #00b894; }

    /* Loading Overlay */
    #loader {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255,255,255,0.9);
        display: none; flex-direction: column;
        justify-content: center; align-items: center; z-index: 1000;
    }
    .spin {
        width: 50px; height: 50px;
        border: 5px solid #f3f3f3; border-top: 5px solid #6c5ce7;
        border-radius: 50%; animation: s 0.8s linear infinite;
    }
    @keyframes s { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div id="loader">
    <div class="spin"></div>
    <p style="margin-top:15px; font-weight: bold; color: #6c5ce7;">‚ö° ƒêang m√£ ho√° vui l√≤ng ch·ªù</p>
</div>

<div class="app-container">
    <h2>Squirrel's Paw</h2>

    <select id="mode">
        <option value="binary">M√£ Nh·ªã ph√¢n</option>
        <option value="decimal">M√£ Th·∫≠p ph√¢n</option>
        <option value="base64">M√£ Base64 (H·ªó tr·ª£ File)</option>
    </select>

    <input type="file" id="fIn" style="display:none">
    <button id="fBtn" onclick="document.getElementById('fIn').click()">üìÅ CH·ªåN FILE ƒê·ªÇ M√É H√ìA</button>
    
    <div id="status"></div>

    <textarea id="txtIn" placeholder="D√°n n·ªôi dung t·∫°i ƒë√¢y..."></textarea>

    <div id="qrSection">
        <img id="qrImg" src="https://via.placeholder.com/180?text=QR+READY">
        <button class="btn btn-qr" onclick="dlQR()">T·∫¢I QR PNG</button>
    </div>

    <button class="btn btn-txt" onclick="dlTXT()">T·∫¢I K·∫æT QU·∫¢ .TXT</button>
</div>

<script>
    const txtIn = document.getElementById('txtIn');
    const mode = document.getElementById('mode');
    const qrSection = document.getElementById('qrSection');
    const fBtn = document.getElementById('fBtn');
    const fIn = document.getElementById('fIn');
    const loader = document.getElementById('loader');
    const status = document.getElementById('status');
    const qrImg = document.getElementById('qrImg');

    let resultData = ""; 
    let qrPath = "";

    // Chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô
    mode.onchange = () => {
        const isBase64 = (mode.value === 'base64');
        fBtn.style.display = isBase64 ? 'block' : 'none';
        qrSection.style.display = isBase64 ? 'none' : 'flex';
        status.style.display = 'none';
        run();
    };

    fIn.onchange = (e) => {
        const file = e.target.files[0];
        if(!file) return;

        // B·∫Øt ƒë·∫ßu x·ª≠ l√Ω
        loader.style.display = "flex";
        status.style.display = "block";
        status.className = "status-wait";
        status.innerText = "‚è≥ ƒêang tr√≠ch xu·∫•t d·ªØ li·ªáu...";

        const reader = new FileReader();
        reader.onload = (ev) => {
            // Gi·∫£ l·∫≠p th·ªùi gian x·ª≠ l√Ω ƒë·ªÉ ng∆∞·ªùi d√πng th·∫•y
            setTimeout(() => {
                resultData = ev.target.result;
                txtIn.value = "[File: " + file.name + "]";
                
                status.className = "status-success";
                status.innerText = "‚úÖ ƒê√£ t·∫°o Base64 th√†nh c√¥ng!";
                loader.style.display = "none";
            }, 1500);
        };
        reader.readAsDataURL(file);
    };

    function run() {
        let val = txtIn.value.trim();
        if(val.startsWith('[File:')) return;

        if(!val) {
            resultData = "";
            qrImg.src = "https://via.placeholder.com/180?text=QR+READY";
            return;
        }

        if(mode.value === 'base64') {
            try { resultData = btoa(unescape(encodeURIComponent(val))); }
            catch(e) { resultData = "Error"; }
        } else {
            let res = "", len = val.length;
            for(let i=0; i<len; i++) {
                let code = val.charCodeAt(i);
                res += (mode.value === 'binary' ? code.toString(2).padStart(8,'0') : code.toString(10)) + " ";
            }
            resultData = res.trim();
            
            // C·∫≠p nh·∫≠t QR
            qrPath = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(val)}`;
            qrImg.src = qrPath;
        }
    }

    txtIn.oninput = run;

    function dlTXT() {
        if(!resultData) return alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i!");
        loader.style.display = "flex";
        
        setTimeout(() => {
            const blob = new Blob([resultData], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "Squirrel_Export.txt";
            a.click();
            loader.style.display = "none";
        }, 800);
    }

    async function dlQR() { 
        if(!qrPath) return alert("Kh√¥ng c√≥ QR!");
        const resp = await fetch(qrPath);
        const blob = await resp.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'QR_Code.png';
        a.click();
    }
</script>
</body>
</html>
