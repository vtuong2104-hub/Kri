<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Text → Binary / Decimal / Base64 + QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    min-height: 100vh;
    padding: 40px 15px;
}

.app {
    max-width: 850px;
    margin: auto;
    background: #fff;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 25px 50px rgba(0,0,0,.15);
}

h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #2d3436;
    text-transform: uppercase;
    letter-spacing: 1px;
}

textarea, select {
    width: 100%;
    display: block;
    margin-bottom: 15px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #dcdde1;
    font-size: 14px;
    outline: none;
}

textarea {
    height: 80px;
    resize: none;
}

.main {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 20px;
}

.box {
    border: 2px dashed #dfe6e9;
    border-radius: 12px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
}

.qr-box img {
    width: 140px; 
    height: 140px;
    background: #f9f9f9;
    margin-bottom: 15px;
}

pre {
    width: 100%;
    margin: 0;
    background: #2d3436;
    color: #00ff00;
    border-radius: 8px;
    padding: 12px;
    font-size: 13px;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.5; 
    max-height: calc(1.5em * 5 + 24px); 
    overflow-y: auto;
}

button {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
    margin-top: 10px;
}

.qr-box button { background: #6c5ce7; }
.output-box button { background: #00b894; }
button:hover { opacity: 0.9; transform: translateY(-2px); }

@media (max-width: 600px) {
    .main { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<div class="app">
    <h2>Squirrel's Paw</h2>

    <textarea id="input" placeholder="Nhập văn bản hoặc link..."></textarea>

    <select id="mode">
        <option value="binary">Mã Nhị phân (Binary)</option>
        <option value="decimal">Mã Thập phân (Decimal)</option>
        <option value="base64">Mã Base64</option>
    </select>

    <div class="main">
        <div class="box qr-box">
            <img id="qrImg" src="https://via.placeholder.com/150?text=QR+Code" alt="QR Code">
            <button onclick="downloadQR()">Tải QR PNG</button>
        </div>

        <div class="box output-box">
            <pre id="output">Kết quả sẽ hiện ở đây...</pre>
            <button onclick="downloadTXT()">Tải File .TXT</button>
        </div>
    </div>
</div>

<script>
let resultText = "";
let qrURL = "";

const inputArea = document.getElementById("input");
const modeSelect = document.getElementById("mode");
const outputPre = document.getElementById("output");
const qrImg = document.getElementById("qrImg");

function process() {
    const inputVal = inputArea.value.trim();
    
    if (!inputVal) {
        outputPre.textContent = "Kết quả sẽ hiện ở đây...";
        qrImg.src = "https://via.placeholder.com/150?text=QR+Code";
        resultText = "";
        return;
    }

    const mode = modeSelect.value;

    if (mode === "base64") {
        // Xử lý Base64 hỗ trợ Unicode (Tiếng Việt)
        try {
            // Encode chuỗi sang UTF-8 trước khi btoa
            resultText = btoa(unescape(encodeURIComponent(inputVal)));
        } catch (e) {
            resultText = "Lỗi: Không thể mã hóa Base64";
        }
    } else {
        // Xử lý Binary và Decimal
        let out = [];
        for (let char of inputVal) {
            const code = char.charCodeAt(0);
            out.push(mode === "binary" ? code.toString(2).padStart(8, "0") : code.toString(10));
        }
        resultText = out.join(" ");
    }

    outputPre.textContent = resultText;

    // 2. Cập nhật QR (Luôn dùng văn bản gốc để QR dễ quét hơn)
    qrURL = "https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=" + encodeURIComponent(inputVal);
    qrImg.src = qrURL;
}

inputArea.addEventListener("input", process);
modeSelect.addEventListener("change", process);

function downloadQR() {
    if (qrURL) window.open(qrURL, '_blank');
}

function downloadTXT() {
    if (!resultText) return;
    const blob = new Blob([resultText], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "encoded_data.txt";
    a.click();
}
</script>

</body>
</html>
