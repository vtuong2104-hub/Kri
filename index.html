<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Squirrel's Paw - Pro Encoder</title>
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }
    .app-container {
        width: 100%;
        max-width: 400px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; color: #333; }
    
    textarea, select, .btn, .modal-input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 14px;
        outline: none;
    }

    #fBtn { background: #6c5ce7; color: white; display: none; font-weight: bold; border: none; cursor: pointer; }
    
    #status {
        font-size: 13px; text-align: center; font-weight: bold;
        display: none; padding: 8px; border-radius: 5px;
    }
    .status-success { color: #00b894; background: #e6faf5; }
    .status-wait { color: #e17055; background: #fff3f0; }

    #qrSection {
        border: 2px dashed #ddd; border-radius: 12px; padding: 20px;
        display: flex; flex-direction: column; align-items: center;
        background: #fafafa; margin-top: 10px;
    }
    #qrImg { width: 180px; height: 180px; margin-bottom: 15px; background: white; }

    .btn { cursor: pointer; border: none; font-weight: bold; color: white; transition: 0.2s; }
    .btn:active { transform: scale(0.98); }
    .btn-qr { background: #0984e3; margin-top: 8px; }
    .btn-txt { background: #00b894; margin-top: 8px; }

    /* LOADER & MODAL OVERLAY */
    .overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        display: none; justify-content: center; align-items: center; z-index: 1000;
    }
    
    /* Box nh·∫≠p t√™n file */
    .modal-box {
        background: white; padding: 20px; border-radius: 12px;
        width: 90%; max-width: 320px; text-align: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    .modal-box h3 { margin-bottom: 15px; font-size: 18px; color: #333; }
    .modal-btns { display: flex; gap: 10px; margin-top: 15px; }

    /* V√≤ng xoay loading */
    .spin {
        width: 50px; height: 50px;
        border: 5px solid #f3f3f3; border-top: 5px solid #6c5ce7;
        border-radius: 50%; animation: s 0.8s linear infinite;
    }
    @keyframes s { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div id="modalName" class="overlay">
    <div class="modal-box">
        <h3>üìÇ ƒê·∫∑t t√™n file</h3>
        <input type="text" id="fileNameInput" class="modal-input" placeholder="V√≠ d·ª•: tailieu_matma">
        <div class="modal-btns">
            <button class="btn" style="background:#b2bec3" onclick="closeModal()">H·ª¶Y</button>
            <button class="btn" style="background:#6c5ce7" onclick="confirmDownload()">T·∫¢I XU·ªêNG</button>
        </div>
    </div>
</div>

<div id="loader" class="overlay" style="background: rgba(255,255,255,0.9); flex-direction: column;">
    <div class="spin"></div>
    <p style="margin-top:15px; font-weight: bold; color: #6c5ce7;">‚ö° ƒêang tƒÉng t·ªëc x·ª≠ l√Ω 500%...</p>
</div>

<div class="app-container">
    <h2>Squirrel's Paw</h2>

    <select id="mode">
        <option value="binary">M√£ Nh·ªã ph√¢n</option>
        <option value="decimal">M√£ Th·∫≠p ph√¢n</option>
        <option value="base64">M√£ Base64 (H·ªó tr·ª£ File)</option>
    </select>

    <input type="file" id="fIn" style="display:none">
    <button id="fBtn" onclick="document.getElementById('fIn').click()">üìÅ CH·ªåN FILE ƒê·ªÇ M√É H√ìA</button>
    
    <div id="status"></div>

    <textarea id="txtIn" placeholder="D√°n n·ªôi dung t·∫°i ƒë√¢y..."></textarea>

    <div id="qrSection">
        <img id="qrImg" src="https://via.placeholder.com/180?text=QR+READY">
        <button class="btn btn-qr" onclick="dlQR()">T·∫¢I QR PNG</button>
    </div>

    <button class="btn btn-txt" onclick="openModal()">T·∫¢I K·∫æT QU·∫¢ .TXT</button>
</div>

<script>
    const txtIn = document.getElementById('txtIn');
    const mode = document.getElementById('mode');
    const qrSection = document.getElementById('qrSection');
    const fBtn = document.getElementById('fBtn');
    const fIn = document.getElementById('fIn');
    const loader = document.getElementById('loader');
    const status = document.getElementById('status');
    const qrImg = document.getElementById('qrImg');
    const modalName = document.getElementById('modalName');
    const fileNameInput = document.getElementById('fileNameInput');

    let resultData = ""; 
    let qrPath = "";

    mode.onchange = () => {
        const isBase64 = (mode.value === 'base64');
        fBtn.style.display = isBase64 ? 'block' : 'none';
        qrSection.style.display = isBase64 ? 'none' : 'flex';
        status.style.display = 'none';
        run();
    };

    fIn.onchange = (e) => {
        const file = e.target.files[0];
        if(!file) return;

        loader.style.display = "flex";
        status.style.display = "block";
        status.className = "status-wait";
        status.innerText = "‚è≥ ƒêang tr√≠ch xu·∫•t d·ªØ li·ªáu...";

        const reader = new FileReader();
        reader.onload = (ev) => {
            setTimeout(() => {
                resultData = ev.target.result;
                txtIn.value = "[File: " + file.name + "]";
                status.className = "status-success";
                status.innerText = "‚úÖ ƒê√£ t·∫°o Base64 th√†nh c√¥ng!";
                loader.style.display = "none";
            }, 1500);
        };
        reader.readAsDataURL(file);
    };

    function run() {
        let val = txtIn.value.trim();
        if(val.startsWith('[File:')) return;
        if(!val) { resultData = ""; qrImg.src = "https://via.placeholder.com/180?text=QR+READY"; return; }

        if(mode.value === 'base64') {
            try { resultData = btoa(unescape(encodeURIComponent(val))); } catch(e) { resultData = "Error"; }
        } else {
            let res = "", len = val.length;
            for(let i=0; i<len; i++) {
                let code = val.charCodeAt(i);
                res += (mode.value === 'binary' ? code.toString(2).padStart(8,'0') : code.toString(10)) + " ";
            }
            resultData = res.trim();
            qrPath = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(val)}`;
            qrImg.src = qrPath;
        }
    }
    txtIn.oninput = run;

    // QU·∫¢N L√ù MODAL T√äN FILE
    function openModal() {
        if(!resultData) return alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i!");
        modalName.style.display = "flex";
        fileNameInput.focus();
    }

    function closeModal() {
        modalName.style.display = "none";
        fileNameInput.value = "";
    }

    function confirmDownload() {
        let name = fileNameInput.value.trim();
        if(!name) {
            alert("Vui l√≤ng nh·∫≠p t√™n file!");
            return;
        }
        
        closeModal();
        loader.style.display = "flex";
        
        setTimeout(() => {
            const blob = new Blob([resultData], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = name + ".txt";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            loader.style.display = "none";
        }, 1200);
    }

    async function dlQR() { 
        if(!qrPath) return alert("Kh√¥ng c√≥ QR!");
        const resp = await fetch(qrPath);
        const blob = await resp.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'QR_Code.png';
        a.click();
    }
</script>
</body>
</html>
